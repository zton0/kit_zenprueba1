<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decisiones 23</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">

<style>
body{
    background:#0f0f0f;
    color:white;
    font-family:'Creepster', cursive;
    min-height:100vh;
}

.hidden{display:none}

.cara-contenedor{
    position:relative;
    width:420px;
    margin:auto;
}

.cara-base{
    width:100%;
}

.overlay{
    position:absolute;
    top:-20px;
    left:-20px;
    width:460px;
    opacity:0;
    pointer-events:none;
    transition:opacity .2s;
}

ul{
    list-style:none;
    padding:0;
    max-height:320px;
    overflow-y:auto;
    border:1px solid #333;
}

.admin-btn{
    position:fixed;
    top:12px;
    right:12px;
    z-index:9999;
}
</style>
</head>

<body class="d-flex justify-content-center align-items-center">

<button class="btn btn-warning btn-sm admin-btn"
        onclick="pedirCredenciales()">
reiniciar listas (solo Zton__)
</button>

<div class="container text-center">

    <div id="pantallaNombre">
        <h1 class="mb-4">Antes de empezar...</h1>
        <input id="nombreInput" class="form-control form-control-lg text-center mb-3" placeholder="Escribe tu nombre">
        <button class="btn btn-danger btn-lg" onclick="iniciar()">Entrar</button>
    </div>

    <div id="pantallaJuego" class="hidden">

        <h1 class="mb-4">decide que hacer con juanes</h1>

        <div class="row align-items-start">

            <div class="col-md-4">
                <h3>Le dieron amor</h3>
                <ul id="listaAmor"></ul>
                <button class="btn btn-success mt-3 w-100" onclick="accion('amor')">
                    darle amor a juanes
                </button>
            </div>

            <div class="col-md-4 d-flex justify-content-center">
                <div class="cara-contenedor">
                    <img src="juanjuan.png" class="cara-base">
                    <img id="overlayAmor" src="beso negro.jpg" class="overlay">
                    <img id="overlayPaliza" src="golpe.jpg" class="overlay">
                </div>
            </div>

            <div class="col-md-4">
                <h3>Le dieron paliza</h3>
                <ul id="listaPaliza"></ul>
                <button class="btn btn-danger mt-3 w-100" onclick="accion('paliza')">
                    darle una paliza a juanes
                </button>
            </div>

        </div>

    </div>
</div>

<audio id="sonidoAmor" src="beso.wav"></audio>
<audio id="sonidoPaliza" src="pedo.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"

const firebaseConfig = {
  apiKey: "AIzaSyAHyo45GtEZ5dpeptzc2MAr4rRLaIXKZJk",
  authDomain: "kitzen-57377.firebaseapp.com",
  databaseURL: "https://kitzen-57377-default-rtdb.firebaseio.com",
  projectId: "kitzen-57377",
  storageBucket: "kitzen-57377.firebasestorage.app",
  messagingSenderId: "780979559137",
  appId: "1:780979559137:web:f2ef04c31bf08a4707b5a0"
}

const app = initializeApp(firebaseConfig)
const db = getDatabase(app)

const overlayAmor = document.getElementById("overlayAmor")
const overlayPaliza = document.getElementById("overlayPaliza")
const sonidoAmor = document.getElementById("sonidoAmor")
const sonidoPaliza = document.getElementById("sonidoPaliza")

let nombreUsuario = ""

window.iniciar = function(){
  const input = document.getElementById("nombreInput").value.trim()
  if(!input) return alert("pon tu nombre")
  nombreUsuario = input
  document.getElementById("pantallaNombre").classList.add("hidden")
  document.getElementById("pantallaJuego").classList.remove("hidden")
}

window.accion = function(tipo){
  if(!nombreUsuario) return

  if(tipo === "amor"){
    overlayAmor.style.opacity = 1
    sonidoAmor.play()
    setTimeout(()=> overlayAmor.style.opacity = 0, 1200)
  }else{
    overlayPaliza.style.opacity = 1
    sonidoPaliza.play()
    setTimeout(()=> overlayPaliza.style.opacity = 0, 1200)
  }

  push(ref(db, tipo), {
    nombre: nombreUsuario,
    fecha: Date.now()
  })
}

function escuchar(tipo, listaId){
  const ul = document.getElementById(listaId)
  const r = ref(db, tipo)

  onValue(r, snap => {
    ul.innerHTML = ""

    if(!snap.exists()) return

    snap.forEach(c => {
      const li = document.createElement("li")
      li.textContent = c.val().nombre
      ul.appendChild(li)
    })

    requestAnimationFrame(() => {
      ul.scrollTop = ul.scrollHeight
    })
  })
}

escuchar("amor","listaAmor")
escuchar("paliza","listaPaliza")

const ADMIN_USER = "oye"
const ADMIN_PASS = "we"

window.pedirCredenciales = function(){
  const user = prompt("usuario")
  const pass = prompt("contraseña")

  if(user === ADMIN_USER && pass === ADMIN_PASS){
    if(confirm("¿reiniciar todas las listas?")){
      remove(ref(db,"amor"))
      remove(ref(db,"paliza"))
    }
  }else{
    alert("credenciales incorrectas")
  }
}
</script>

</body>
</html>
